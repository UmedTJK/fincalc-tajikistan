<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinCalc.TJ | –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞</title>
    <link rel="stylesheet" href="style.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="script.js"></script>

</head>
<body data-theme="default">

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ header –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ -->
<header class="hero" id="header-container">
  <!-- Header –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</header>

<section class="calculator-area">
  <div class="main-container">
    <div class="container">
        <div class="main-content">
            <!-- Calculator Form –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å—é–¥–∞ -->
            <div id="calculator-container"></div>
            
            <!-- Export Panel –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å—é–¥–∞ -->
            <div id="export-container"></div>
            
            <!-- Table & Chart –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å—é–¥–∞ -->
            <div id="table-chart-container"></div>
        </div>
    </div>
  </div>
</section>


<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ—É—Ç–µ—Ä–∞ -->
<div id="footer-container"></div>


<script type="module">
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é applyTheme
    import { applyTheme } from './modules/ui/themes.js';
    
    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π
    window.applyTheme = applyTheme;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π —Ç–µ–º
    document.addEventListener('DOMContentLoaded', function() {
        const themeButtons = document.querySelectorAll('.theme-btn-banner');
        const savedTheme = localStorage.getItem('selectedTheme') || 'default';
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
        applyTheme(savedTheme);
        document.body.setAttribute('data-theme', savedTheme);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        themeButtons.forEach(btn => {
            const theme = btn.getAttribute('data-theme');
            
            if (theme === savedTheme) {
                btn.classList.add('active');
            }
            
            btn.addEventListener('click', () => {
                const selectedTheme = btn.getAttribute('data-theme');
                
                // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                themeButtons.forEach(b => b.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                btn.classList.add('active');
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
                applyTheme(selectedTheme);
                document.body.setAttribute('data-theme', selectedTheme);
                localStorage.setItem('selectedTheme', selectedTheme);
            });
        });
        
        // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç–µ–º –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        const oldThemeButtons = document.querySelectorAll('.theme-btn');
        oldThemeButtons.forEach(btn => {
            const theme = btn.getAttribute('data-theme');
            
            if (theme === savedTheme) {
                btn.classList.add('active');
            }
            
            btn.addEventListener('click', () => {
                const selectedTheme = btn.getAttribute('data-theme');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–∞ –Ω–∞–±–æ—Ä–∞ –∫–Ω–æ–ø–æ–∫
                themeButtons.forEach(b => b.classList.remove('active'));
                oldThemeButtons.forEach(b => b.classList.remove('active'));
                
                btn.classList.add('active');
                themeButtons.forEach(b => {
                    if (b.getAttribute('data-theme') === selectedTheme) {
                        b.classList.add('active');
                    }
                });
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
                applyTheme(selectedTheme);
                document.body.setAttribute('data-theme', selectedTheme);
                localStorage.setItem('selectedTheme', selectedTheme);
            });
        });
    });
</script>

<script type="module">
    // –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ—É—Ç–µ—Ä–∞ –∫–∞–∫ fallback
    document.addEventListener('DOMContentLoaded', async () => {
        // –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É —á—Ç–æ–±—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
        setTimeout(async () => {
            const footerContainer = document.getElementById('footer-container');
            
            if (!footerContainer) {
                console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ—É—Ç–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ —Ñ—É—Ç–µ—Ä —É–∂–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è —Å–∏—Å—Ç–µ–º–æ–π
            const isFooterLoaded = footerContainer.innerHTML && 
                                  !footerContainer.innerHTML.includes('–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è') &&
                                  !footerContainer.innerHTML.includes('–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è') &&
                                  !footerContainer.innerHTML.includes('footer-placeholder');
            
            if (isFooterLoaded) {
                console.log('‚úÖ –§—É—Ç–µ—Ä —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω —Å–∏—Å—Ç–µ–º–æ–π');
                return;
            }
            
            console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ—É—Ç–µ—Ä –Ω–∞–ø—Ä—è–º—É—é...');
            
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏
                const { Footer } = await import('./modules/ui/components/Footer/footer.js');
                const footer = new Footer();
                footer.init(footerContainer);
                console.log('‚úÖ –§—É—Ç–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞–ø—Ä—è–º—É—é');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ—É—Ç–µ—Ä–∞:', error.message);
                
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π fallback —Ñ—É—Ç–µ—Ä
                const currentYear = new Date().getFullYear();
                footerContainer.innerHTML = `
                    <footer style="
                        background: var(--surface); 
                        border-top: 1px solid var(--border); 
                        padding: 2rem 0; 
                        margin-top: 3rem;
                        width: 100%;
                    ">
                        <div style="
                            max-width: 1200px; 
                            margin: 0 auto; 
                            padding: 0 1rem;
                        ">
                            <div style="
                                text-align: center; 
                                color: var(--text-light);
                            ">
                                <div style="
                                    font-size: 1.5rem; 
                                    font-weight: 700; 
                                    color: var(--primary); 
                                    margin-bottom: 0.5rem;
                                ">
                                    FinCalc.TJ
                                    <span style="
                                        font-size: 0.875rem; 
                                        background: var(--surface); 
                                        padding: 0.125rem 0.5rem; 
                                        border-radius: 6px; 
                                        border: 1px solid var(--border); 
                                        margin-left: 0.5rem;
                                    ">
                                        v0.6.1
                                    </span>
                                </div>
                                <p style="margin-bottom: 1rem; line-height: 1.6;">
                                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –¥–ª—è –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞
                                </p>
                                <div style="
                                    border-top: 1px solid var(--border); 
                                    padding-top: 1rem; 
                                    font-size: 0.875rem;
                                ">
                                    ¬© ${currentYear} FinCalc.TJ. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.<br>
                                    <small>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.</small>
                                </div>
                            </div>
                        </div>
                    </footer>
                `;
                console.log('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ñ—É—Ç–µ—Ä');
            }
        }, 1000); // –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É
    });
</script>


</body>
</html>